(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1851:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var a=r(5155),n=r(2115),s=r(7129),o=r(3101),i=r(2821),l=r(5889);function d(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,l.QP)((0,i.$)(t))}let c=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function u(e){let{className:t,variant:r,size:n,asChild:o=!1,...i}=e,l=o?s.DX:"button";return(0,a.jsx)(l,{"data-slot":"button",className:d(c({variant:r,size:n,className:t})),...i})}var m=r(4844);function g(){let[e,t]=(0,n.useState)("idle"),r=(0,n.useRef)(null),s=(0,n.useRef)(void 0),{isConnected:o,connect:i,disconnect:l}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onStateChange:t}=e,[r,a]=(0,n.useState)(!1),[s,o]=(0,n.useState)(!1),[i,l]=(0,n.useState)("idle"),[d,c]=(0,n.useState)(""),[u,g]=(0,n.useState)(""),p=(0,n.useRef)(void 0),h=(0,n.useRef)(void 0),f=(0,n.useRef)(void 0),x=(0,n.useRef)(void 0),v=(0,n.useRef)(!1);(0,n.useEffect)(()=>()=>{p.current&&(p.current.close(),p.current=void 0)},[]);let b=(0,n.useCallback)(e=>{l(e),null==t||t(e)},[t]),y=(0,n.useCallback)(()=>{b(v.current?"muted":"listening")},[b]),w=(0,n.useCallback)(e=>{e.on("transport_event",e=>{console.log("[Primer] Transport event:",e.type,e),"connection_change"===e.type&&(console.log("[Primer] Connection status changed"),y())}),e.on("agent_start",(e,t)=>{console.log("[Primer] Agent started responding",{agent:t.name,context:e}),b("thinking")}),e.on("agent_end",(e,t,r)=>{console.log("[Primer] Agent finished responding",{agent:t.name,output:r})}),e.on("audio_start",(e,t)=>{console.log("[Primer] Audio output started",{agent:t.name}),b("speaking")}),e.on("audio_stopped",(e,t)=>{console.log("[Primer] Audio output stopped",{agent:t.name}),y()}),e.on("audio_interrupted",(e,t)=>{console.log("[Primer] Audio interrupted",{agent:t.name}),y()}),e.on("history_updated",e=>{console.log("[Primer] History updated, items:",e.length),console.log("[Primer] Latest history items:",e.slice(-3))}),e.on("history_added",e=>{console.log("[Primer] History item added:",e)}),e.on("agent_tool_start",(e,t,r,a)=>{console.log("[Primer] Tool call started",{tool:r.name,details:a})}),e.on("agent_tool_end",(e,t,r,a,n)=>{console.log("[Primer] Tool call ended",{tool:r.name,result:a,details:n})}),e.on("error",e=>{console.error("[Primer] Realtime session error:",e),alert("Realtime session error. Please check the console for details."),a(!1),b("idle")})},[b,y]),k=(0,n.useCallback)(async()=>{if(s||r)return;let e=localStorage.getItem("primer_api_key"),t=localStorage.getItem("primer_system_prompt")||"You are Primer, a friendly and patient AI tutor for children. You explain things in simple, engaging ways and encourage curiosity and learning. You are kind, supportive, and always make learning fun.";if(!e)return void alert("Please set your OpenAI API key in settings first!");o(!0);try{console.log("[Primer] Exchanging API key for ephemeral client key...");let r=await fetch("https://api.openai.com/v1/realtime/client_secrets",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({session:{type:"realtime",model:"gpt-realtime"}})});if(!r.ok){let e=await r.text();throw Error("Failed to get ephemeral key: ".concat(r.status," ").concat(e))}let n=(await r.json()).value;if(!n||!n.startsWith("ek_"))throw Error("Invalid ephemeral key received from OpenAI");console.log("[Primer] Successfully obtained ephemeral key:",n.substring(0,10)+"...");let s=new m.lo({name:"Primer",instructions:t,voice:"alloy"});h.current=s,console.log("[Primer] Created RealtimeAgent:",s.name);let o={config:{model:"gpt-realtime",instructions:t,toolChoice:"auto",tools:[],audio:{input:{turnDetection:{type:"server_vad",threshold:.65,prefixPaddingMs:450,silenceDurationMs:1200},transcription:{model:"gpt-4o-mini-transcribe"}},output:{voice:"alloy"}}}};console.log("[Primer] Session config:",o);let i=new m.Ko(s,o);p.current=i,console.log("[Primer] Created RealtimeSession"),w(i),console.log("[Primer] Registered session listeners"),console.log("[Primer] Connecting to OpenAI Realtime API..."),v.current=!0,await i.connect({apiKey:n,model:"gpt-realtime"}),console.log("[Primer] Successfully connected! Transport:",i.transport),console.log("[Primer] Current agent:",i.currentAgent.name),console.log("[Primer] Microphone should be active now"),a(!0),b("muted"),console.log("[Primer] Ready to chat!"),i.mute(!0),console.log("[Primer] Muted microphone for welcome message"),x.current&&window.clearTimeout(x.current),x.current=window.setTimeout(()=>{p.current&&(p.current.mute(!1),v.current=!1,x.current=void 0,console.log("[Primer] Unmuted microphone after welcome window"),b("listening"))},5e3),i.transport.sendEvent({type:"response.create",response:{instructions:'Speak a short, encouraging welcome so the child knows you are ready to chat. Say something like: "Hi there! I\'m Primer, your learning buddy. What would you like to explore today?"'}})}catch(e){console.error("[Primer] Failed to connect to realtime session",e),x.current&&(window.clearTimeout(x.current),x.current=void 0),v.current=!1,alert(e instanceof Error?"Failed to connect: ".concat(e.message):"Failed to connect to the realtime session. Please check your API key and microphone permissions."),b("idle")}finally{o(!1)}},[b,r,s,w]);return{isConnected:r,isConnecting:s,currentState:i,latestTranscript:d,latestResponse:u,connect:k,disconnect:(0,n.useCallback)(()=>{console.log("[Primer] Disconnecting..."),p.current&&(p.current.close(),p.current=void 0,console.log("[Primer] Session closed")),f.current&&(f.current.pause(),f.current.src="",f.current=void 0,console.log("[Primer] Audio element cleaned up")),x.current&&(window.clearTimeout(x.current),x.current=void 0),v.current=!1,a(!1),g(""),c(""),b("idle"),console.log("[Primer] Disconnected successfully")},[b]),interrupt:(0,n.useCallback)(()=>{console.log("[Primer] Interrupting current response..."),p.current&&(p.current.interrupt(),y(),console.log("[Primer] Response interrupted"))},[b,y])}}({onStateChange:e=>{t(e)}});(0,n.useEffect)(()=>{let t=r.current;if(!t)return;let a=t.getContext("2d");if(!a)return;let n=window.devicePixelRatio||1;t.width=300*n,t.height=300*n,a.scale(n,n);let o=0,i=()=>{a.clearRect(0,0,300,300);for(let t=0;t<3;t++){let r,n=.3*t;a.beginPath();for(let r=0;r<=100;r++){let s=r/100*Math.PI*2,i=80+("listening"===e?8*Math.sin(2*o+.1*r+n):"thinking"===e?5*Math.sin(3*o+.2*r+n):"speaking"===e?12*Math.sin(4*o+.15*r+n):3*Math.sin(o+.05*r+n))-10*t,l=150+Math.cos(s)*i,d=150+Math.sin(s)*i;0===r?a.moveTo(l,d):a.lineTo(l,d)}a.closePath(),"listening"===e?((r=a.createRadialGradient(150,150,0,150,150,80)).addColorStop(0,"rgba(139, 92, 246, 0.6)"),r.addColorStop(1,"rgba(59, 130, 246, 0.3)")):"thinking"===e?((r=a.createRadialGradient(150,150,0,150,150,80)).addColorStop(0,"rgba(236, 72, 153, 0.6)"),r.addColorStop(1,"rgba(139, 92, 246, 0.3)")):"speaking"===e?((r=a.createRadialGradient(150,150,0,150,150,80)).addColorStop(0,"rgba(251, 191, 36, 0.6)"),r.addColorStop(1,"rgba(245, 158, 11, 0.3)")):((r=a.createRadialGradient(150,150,0,150,150,80)).addColorStop(0,"rgba(139, 92, 246, 0.4)"),r.addColorStop(1,"rgba(99, 102, 241, 0.2)")),a.fillStyle=r,a.fill(),a.shadowBlur=20,a.shadowColor="speaking"===e?"rgba(251, 191, 36, 0.5)":"rgba(139, 92, 246, 0.5)"}o+=.02,s.current=requestAnimationFrame(i)};return i(),()=>{s.current&&cancelAnimationFrame(s.current)}},[e]);let d=async()=>{o||await i()};return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-8",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full transition-all duration-500 ".concat("listening"===e?"ring-4 ring-primary/30 scale-110":"thinking"===e?"ring-4 ring-secondary/30 scale-110":"speaking"===e?"ring-4 ring-accent/30 scale-110":"ring-2 ring-primary/10")}),(0,a.jsx)("button",{onClick:d,disabled:o,className:"relative block rounded-full overflow-hidden shadow-2xl transition-transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-primary/50 disabled:cursor-default disabled:hover:scale-100","aria-label":o?"Connected - speak to Primer":"Connect to Primer",children:(0,a.jsx)("canvas",{ref:r,width:300,height:300,className:"w-[300px] h-[300px]"})}),(0,a.jsx)("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 px-4 py-1.5 rounded-full bg-card/90 backdrop-blur-sm shadow-lg border",children:(0,a.jsxs)("p",{className:"text-sm font-medium",children:[!o&&"Click to start",o&&"idle"===e&&"Ready to chat",o&&"muted"===e&&"Getting ready...","listening"===e&&"Listening...","thinking"===e&&"Thinking...","speaking"===e&&"Speaking..."]})})]}),o&&(0,a.jsx)("div",{className:"flex gap-3",children:(0,a.jsx)(u,{variant:"outline",size:"lg",onClick:()=>{l(),t("idle")},className:"rounded-full shadow-lg bg-transparent",children:"End Chat"})}),o&&"muted"!==e&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center max-w-md",children:"Just start speaking! Primer is listening and will respond automatically."}),o&&"muted"===e&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center max-w-md",children:"Primer is saying hello—your microphone will open in just a moment."})]})}var p=r(7229),h=r(5229);let f=p.bL;p.l9,p.bm;let x=p.ZL,v=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(p.hJ,{className:d("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...n,ref:t})});v.displayName=p.hJ.displayName;let b=n.forwardRef((e,t)=>{let{className:r,children:n,...s}=e;return(0,a.jsxs)(x,{children:[(0,a.jsx)(v,{}),(0,a.jsxs)(p.UC,{ref:t,className:d("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500 inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",r),...s,children:[n,(0,a.jsxs)(p.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});b.displayName=p.UC.displayName;let y=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:d("flex flex-col space-y-2 text-center sm:text-left",t),...r})};y.displayName="SheetHeader";let w=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(p.hE,{ref:t,className:d("text-lg font-semibold text-foreground",r),...n})});w.displayName=p.hE.displayName;let k=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(p.VY,{ref:t,className:d("text-sm text-muted-foreground",r),...n})});k.displayName=p.VY.displayName;var N=r(2894);function j(e){let{className:t,...r}=e;return(0,a.jsx)(N.b,{"data-slot":"label",className:d("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...r})}function P(e){let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,"data-slot":"input",className:d("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}function C(e){let{className:t,...r}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:d("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...r})}let S=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:d("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",r),...n})});S.displayName="Alert";let _=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:d("text-sm [&_p]:leading-relaxed",r),...n})});_.displayName="AlertDescription";var A=r(3327),R=r(6046);let I="You are Primer, a magical learning companion for children inspired by \"The Young Lady's Illustrated Primer\" from Neal Stephenson's Diamond Age. \n\nYour role is to:\n- Be warm, encouraging, and patient\n- Explain concepts in age-appropriate ways\n- Ask thoughtful questions to encourage curiosity\n- Celebrate learning and discovery\n- Keep conversations safe and educational\n- Use storytelling to make learning engaging\n\nAlways maintain a friendly, supportive tone and adapt your explanations to the child's level of understanding.";function z(e){let{open:t,onOpenChange:r}=e,[s,o]=(0,n.useState)(""),[i,l]=(0,n.useState)(I),[d,c]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=localStorage.getItem("primer_api_key"),t=localStorage.getItem("primer_system_prompt");e&&o(e),t&&l(t)},[]),(0,a.jsx)(f,{open:t,onOpenChange:r,children:(0,a.jsxs)(b,{className:"w-full sm:max-w-xl overflow-y-auto",children:[(0,a.jsxs)(y,{children:[(0,a.jsx)(w,{className:"text-2xl",children:"Parent Settings"}),(0,a.jsx)(k,{children:"Configure Primer's behavior and connection settings"})]}),(0,a.jsxs)("div",{className:"mt-8 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(j,{htmlFor:"api-key",className:"text-base font-semibold",children:"OpenAI API Key"}),(0,a.jsx)(P,{id:"api-key",type:"password",placeholder:"sk-...",value:s,onChange:e=>o(e.target.value),className:"font-mono text-sm"}),(0,a.jsxs)(S,{children:[(0,a.jsx)(A.A,{className:"h-4 w-4"}),(0,a.jsxs)(_,{className:"text-sm",children:["Your API key is stored locally in your browser and never sent to our servers. When you connect, it's exchanged for a short-lived ephemeral key for secure WebRTC communication. Get your key from"," ",(0,a.jsx)("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-primary",children:"OpenAI's platform"}),"."]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(j,{htmlFor:"system-prompt",className:"text-base font-semibold",children:"System Prompt"}),(0,a.jsx)(u,{variant:"ghost",size:"sm",onClick:()=>{l(I)},className:"text-xs",children:"Reset to Default"})]}),(0,a.jsx)(C,{id:"system-prompt",value:i,onChange:e=>l(e.target.value),rows:12,className:"font-mono text-sm resize-none"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Customize how Primer interacts with your child. This prompt guides the AI's personality and behavior."})]}),(0,a.jsxs)("div",{className:"pt-4",children:[(0,a.jsxs)(u,{onClick:()=>{localStorage.setItem("primer_api_key",s),localStorage.setItem("primer_system_prompt",i),c(!0),setTimeout(()=>c(!1),3e3)},className:"w-full",size:"lg",children:[(0,a.jsx)(R.A,{className:"mr-2 h-5 w-5"}),"Save Settings"]}),d&&(0,a.jsx)("p",{className:"mt-3 text-sm text-center text-primary font-medium",children:"✓ Settings saved successfully!"})]}),(0,a.jsxs)(S,{className:"bg-muted/50",children:[(0,a.jsx)(A.A,{className:"h-4 w-4"}),(0,a.jsxs)(_,{className:"text-sm",children:[(0,a.jsx)("strong",{children:"Note:"})," Changes take effect the next time you start a conversation with Primer."]})]})]})]})})}var T=r(5870);function E(){let[e,t]=(0,n.useState)(!1);return(0,a.jsxs)("div",{className:"relative min-h-screen overflow-hidden",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-primary/5 via-secondary/5 to-accent/5"}),(0,a.jsxs)("div",{className:"fixed inset-0 pointer-events-none",children:[(0,a.jsx)("div",{className:"absolute top-[10%] left-[15%] w-2 h-2 bg-accent rounded-full sparkle",style:{animationDelay:"0s"}}),(0,a.jsx)("div",{className:"absolute top-[20%] right-[20%] w-1.5 h-1.5 bg-primary rounded-full sparkle",style:{animationDelay:"0.5s"}}),(0,a.jsx)("div",{className:"absolute bottom-[30%] left-[25%] w-2 h-2 bg-secondary rounded-full sparkle",style:{animationDelay:"1s"}}),(0,a.jsx)("div",{className:"absolute bottom-[15%] right-[15%] w-1.5 h-1.5 bg-accent rounded-full sparkle",style:{animationDelay:"1.5s"}}),(0,a.jsx)("div",{className:"absolute top-[40%] right-[10%] w-1 h-1 bg-primary rounded-full sparkle",style:{animationDelay:"2s"}})]}),(0,a.jsx)("div",{className:"fixed top-6 right-6 z-50",children:(0,a.jsxs)(u,{variant:"outline",size:"icon",onClick:()=>t(!e),className:"rounded-full shadow-lg bg-card/80 backdrop-blur-sm hover:bg-card",children:[(0,a.jsx)(T.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"sr-only",children:"Settings"})]})}),(0,a.jsxs)("main",{className:"relative z-10 flex min-h-screen flex-col items-center justify-center p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-12 space-y-4",children:[(0,a.jsx)("h1",{className:"text-5xl md:text-6xl font-bold text-balance bg-gradient-to-r from-primary via-secondary to-accent bg-clip-text text-transparent",children:"Primer"}),(0,a.jsx)("p",{className:"text-lg md:text-xl text-muted-foreground text-balance max-w-md mx-auto",children:"Your magical learning companion"})]}),(0,a.jsx)(g,{}),(0,a.jsx)("div",{className:"mt-12 text-center text-sm text-muted-foreground max-w-sm",children:(0,a.jsx)("p",{className:"text-balance",children:"Tap the orb to start a conversation with Primer"})})]}),(0,a.jsx)(z,{open:e,onOpenChange:t})]})}},6402:(e,t,r)=>{Promise.resolve().then(r.bind(r,1851))}},e=>{e.O(0,[343,441,255,358],()=>e(e.s=6402)),_N_E=e.O()}]);